<!DOCTYPE html>
<html>
<head>
    <title>Landslide Susceptibility Grading – Nilgiris District random forest</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
    <style>
        html, body, #map { height: 100%; margin: 0; padding: 0; }
        #title {
            position: absolute;
            top: 10px;
            left: 45px;
            z-index: 999;
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-family: sans-serif;
            font-size: 18px;
            font-weight: bold;
        }
        #legend {
            position: absolute;
            bottom: 40px;
            left: 10px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 999;
            font-family: sans-serif;
            font-size: 14px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 8px;
        }
        #open-pdf-button, #download-btn {
            position: absolute;
            top: 200px;
            right: 10px;
            z-index: 999;
            padding: 10px 20px;
            background: #008CBA;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }
        #download-btn {
            top: 250px;
        }
        #footer-note {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: white;
            padding: 5px 10px;
            font-family: sans-serif;
            font-size: 12px;
            border-radius: 4px;
            z-index: 999;
        }
        #coordinates {
            position: absolute;
            bottom: 10px;
            left: 100px;
            background: rgba(255,255,255,0.9);
            padding: 5px 10px;
            border-radius: 5px;
            font-family: sans-serif;
            font-size: 13px;
            z-index: 999;
        }
        #north-arrow {
            position: absolute;
            top: 10px;
            right: 60px;
            z-index: 999;
        }
        #north-arrow img {
            height: 40px;
        }
    </style>
</head>
<body>
    <div id="title">Landslide Susceptibility Grading – Nilgiris District</div>
    <div id="map"></div>
    <div id="legend">
        <strong>Landslide Susceptibility grading</strong><br />
        <div class="legend-item"><div class="legend-color" style="background:green;"></div>Very Low (1)</div>
        <div class="legend-item"><div class="legend-color" style="background:yellow;"></div>Low (2)</div>
        <div class="legend-item"><div class="legend-color" style="background:orange;"></div>Moderate (3)</div>
        <div class="legend-item"><div class="legend-color" style="background:blue;"></div>High (4)</div>
        <div class="legend-item"><div class="legend-color" style="background:red;"></div>Very High (5)</div>
    </div>
    <div id="coordinates">Lat: --, Lng: --</div>
    <div id="north-arrow"><img src="NA.png" alt="North Arrow"></div>
    <button id="open-pdf-button">View Report</button>
    <button id="download-btn">Download Layer</button>
    <div id="footer-note">This map is generated by Random Forest Machine Learning Algorithm using Google Earth Engine.</div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-omnivore@0.3.1/leaflet-omnivore.min.js"></script>
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>

    <script>
        var map = L.map('map').setView([11.35, 76.6], 10);

        var street = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap'
        }).addTo(map);

        var satellite = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenTopoMap'
        });

        var baseLayers = {
            "Street View": street,
            "Satellite View": satellite
        };

        var susceptibilityLayer = omnivore.geojson('RFnilGJSON.geojson', null, L.geoJson(null, {
            style: function (feature) {
                var colorMap = {
                    1: 'green',
                    2: 'yellow',
                    3: 'orange',
                    4: 'blue',
                    5: 'red'
                };
                return {
                    fillColor: colorMap[feature.properties.DN] || 'gray',
                    color: '#222',
                    weight: 0.1,
                    fillOpacity: 1
                };
            },
            onEachFeature: function (feature, layer) {
                var labels = ['Very Low', 'Low', 'Moderate', 'High', 'Very High'];
                var val = feature.properties.DN;
                var label = labels[val - 1] || 'Unknown';
                layer.bindPopup(`<b>Landslide Class:</b> ${label}<br><b>Value:</b> ${val}`);
            }
        }));

        susceptibilityLayer.on('ready', function () {
            map.fitBounds(susceptibilityLayer.getBounds());
            susceptibilityLayer.addTo(map);
        });

        var inventoryLayer = omnivore.geojson('LSLOC.geojson', null, L.geoJson(null, {
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, {
                    radius: 5,
                    fillColor: 'black',
                    color: 'white',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.9
                }).bindPopup("Landslide Point");
            }
        }));

        var overlays = {
            "Landslide Susceptibility": susceptibilityLayer,
            "Landslide Inventory": inventoryLayer
        };
        L.control.layers(baseLayers, overlays).addTo(map);

        document.getElementById('open-pdf-button').addEventListener('click', function () {
            window.open('report.pdf', '_blank');
        });

        document.getElementById('download-btn').addEventListener('click', function () {
            var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(susceptibilityLayer.toGeoJSON()));
            var dlAnchorElem = document.createElement('a');
            dlAnchorElem.setAttribute("href", dataStr);
            dlAnchorElem.setAttribute("download", "susceptibility_layer.geojson");
            dlAnchorElem.click();
        });

        var drawnItems = new L.FeatureGroup();
        map.addLayer(drawnItems);
        var drawControl = new L.Control.Draw({
            edit: {
                featureGroup: drawnItems
            },
            draw: {
                polygon: true,
                polyline: true,
                rectangle: true,
                circle: false,
                marker: true,
                circlemarker: false
            }
        });
        map.addControl(drawControl);

        map.on(L.Draw.Event.CREATED, function (e) {
            var layer = e.layer;
            drawnItems.addLayer(layer);
        });

        L.control.scale({ position: 'bottomleft', metric: true, imperial: false }).addTo(map);

        // Latitude/Longitude on mouse move
        var coordDiv = document.getElementById('coordinates');
        map.on('mousemove', function (e) {
            coordDiv.innerHTML = `Lat: ${e.latlng.lat.toFixed(4)}, Lng: ${e.latlng.lng.toFixed(4)}`;
        });
    </script>
</body>
</html>
